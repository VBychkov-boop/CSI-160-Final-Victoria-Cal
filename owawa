import discord
from discord.ext import commands
import string

# Setting up the bot
intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix='!', intents=intents)

# Cipher setup
ascii_letters_plus = string.ascii_letters + " "
let_num_conversion = {'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7, 'H': 8, 'I': 9, 'J': 10, 'K': 11, 'L': 12,
                      'M': 13, 'N': 14, 'O': 15, 'P': 16, 'Q': 17, 'R': 18, 'S': 19, 'T': 20, 'U': 21, 'V': 22, 'W': 23,
                      'X': 24, 'Y': 25, 'Z': 26
                      }


def check_alpha(pl_base, pl_key):
    """Check if base and key are valid"""
    if (pl_base == "") or (pl_key == ""):
        return False, "Please do not leave either input blank."

    if not all(char in string.ascii_letters for char in pl_key):
        return False, "Please enter a one word key with only letters."

    if not all(char in ascii_letters_plus for char in pl_base):
        return False, "Please enter only letters or spaces in the message."

    return True, "Valid"


def separate_words(pl_base):
    """Separate sentence into words"""
    words = pl_base.split(' ')
    return words


def encode(pl_words, pl_key):
    """Encode the message using Vigenère cipher"""
    counter = 0
    encoded = ''
    counter2 = 0

    for l in pl_words:
        for m in pl_words[counter2]:
            x = let_num_conversion.get(m.upper())
            n = pl_key[(counter % len(pl_key))]
            y = let_num_conversion.get(n.upper())
            shift = (x + y) % 26

            for key, val in let_num_conversion.items():
                if val == shift:
                    letter = key
                    break

            if m.isupper():
                letter1 = letter
            else:
                letter1 = letter.lower()

            encoded += letter1
            counter += 1
        counter2 += 1
        encoded += ' '

    return encoded.strip()


@bot.event
async def on_ready():
    print(f'{bot.user} has connected to Discord!')
    print('Ready to encode messages!')


@bot.command(name='encode', help='Encode a message. Usage: !encode <key> <message>')
async def encode_command(ctx, key: str, *, message: str):
    """Encode a message using Vigenère cipher"""
    # Check if inputs are valid
    is_valid, error_msg = check_alpha(message, key)

    if not is_valid:
        await ctx.send(f' Error: {error_msg}')
        return

    # Encode the message
    words = separate_words(message)
    encoded_message = encode(words, key)

    # Send the result
    embed = discord.Embed(title=" Encoded Message", color=discord.Color.green())
    embed.add_field(name="Original", value=message, inline=False)
    embed.add_field(name="Key", value=key, inline=False)
    embed.add_field(name="Encoded", value=encoded_message, inline=False)

    await ctx.send(embed=embed)


# Use the token bot code here
bot.run('MTQ0MDM5NzkzMTI0MzkwMTAwOA.GdmNlX.LoZhphB579OD3k-65ySMx3CV7suIduYMHF9ipk')
